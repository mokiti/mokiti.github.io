<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>モンスト周回カウンター (勝率計算機能つき)</title>
    <style>
        /* デザイン部分は変更なし */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f0f2f5; color: #1c1e21; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; }
        .add-form { display: flex; gap: 10px; margin-bottom: 25px; }
        .add-form input { flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        .add-form button { padding: 12px 18px; border: none; background-color: #007bff; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .counter-list { display: flex; flex-direction: column; gap: 15px; }
        .counter-item { padding: 15px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; }
        .counter-item .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .counter-item .name { font-size: 1.4rem; font-weight: bold; }
        .counter-item .delete-btn { background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .counter-item .body { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
        .counter-item .stat-box { padding: 10px; background-color: #fff; border-radius: 6px; }
        .counter-item .stat-box .label { font-size: 0.9rem; color: #606770; }
        .counter-item .stat-box .value { font-size: 1.8rem; font-weight: bold; }
        .counter-item .actions { grid-column: 1 / -1; display: flex; gap: 10px; margin-top: 15px; }
        .counter-item .actions button { flex-grow: 1; padding: 12px; font-size: 1.1rem; border-radius: 6px; cursor: pointer; border: none; font-weight: bold; }
        .counter-item .win-btn { background-color: #28a745; color: white; }
        .counter-item .lose-btn { background-color: #ffc107; color: #212529; }
    </style>
</head>
<body>

    <div class="container">
        <h1>モンスト周回カウンター</h1>

        <div class="add-form">
            <input type="text" id="questNameInput" placeholder="新しいクエスト名を入力">
            <button id="addBtn">カウンター追加</button>
        </div>

        <div id="counterList" class="counter-list">
            </div>
    </div>

    <script>
        const questNameInput = document.getElementById('questNameInput');
        const addBtn = document.getElementById('addBtn');
        const counterList = document.getElementById('counterList');
        const STORAGE_KEY = 'monstCountersWinRate';

        let counters = [];

        function saveCounters() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(counters));
        }

        function loadCounters() {
            const data = localStorage.getItem(STORAGE_KEY);
            counters = data ? JSON.parse(data) : [];
        }

        function renderCounters() {
            counterList.innerHTML = '';
            counters.forEach(counter => {
                const totalGames = counter.wins + counter.losses;
                const winRate = totalGames > 0 ? ((counter.wins / totalGames) * 100).toFixed(1) : '0.0';
                const counterElement = document.createElement('div');
                counterElement.className = 'counter-item';
                counterElement.dataset.id = counter.id;
                counterElement.innerHTML = `
                    <div class="header">
                        <div class="name">${counter.name}</div>
                        <button class="delete-btn">削除</button>
                    </div>
                    <div class="body">
                        <div class="stat-box">
                            <div class="label">勝ち</div>
                            <div class="value">${counter.wins}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">負け</div>
                            <div class="value">${counter.losses}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">勝率</div>
                            <div class="value">${winRate}%</div>
                        </div>
                        <div class="actions">
                            <button class="win-btn">🎉 勝ち</button>
                            <button class="lose-btn">💧 負け</button>
                        </div>
                    </div>
                `;
                counterList.appendChild(counterElement);
            });
        }
        
        // ★★★ ここを修正しました ★★★
        addBtn.addEventListener('click', () => {
            const questName = questNameInput.value.trim();
            if (questName === '') {
                alert('クエスト名を入力してください'); // アラートを追加
                return;
            }

            counters.push({
                id: Date.now(),
                name: questName,
                wins: 0,
                losses: 0
            });
            questNameInput.value = '';
            saveCounters();
            renderCounters();
        });

        counterList.addEventListener('click', (event) => {
            const target = event.target;
            const parentItem = target.closest('.counter-item');
            if (!parentItem) return;
            const id = Number(parentItem.dataset.id);
            const counter = counters.find(c => c.id === id);
            if (!counter) return;

            if (target.classList.contains('win-btn')) {
                counter.wins++;
            } else if (target.classList.contains('lose-btn')) {
                counter.losses++;
            } else if (target.classList.contains('delete-btn')) {
                if (confirm(`「${counter.name}」を削除しますか？`)) {
                    counters = counters.filter(c => c.id !== id);
                }
            } else {
                return;
            }
            saveCounters();
            renderCounters();
        });

        loadCounters();
        renderCounters();
    </script>
</body>
</html>